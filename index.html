
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>NPS Orbit - Smart Retirement Planning</title>
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        :root {
            --primary: #00d4ff;
            --secondary: #ff6b35;
            --accent: #ffd700;
            --dark-1: #0a0e27;
            --dark-2: #1a1f3a;
            --card: rgba(255, 255, 255, 0.05);
            --text-1: #ffffff;
            --text-2: #a0a0a0;
            --success: #00ff88;
            --warning: #ffaa00;
            --danger: #ff4444;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, var(--dark-1) 0%, var(--dark-2) 100%);
            color: var(--text-1);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 16px;
        }

        .header {
            text-align: center;
            padding: 24px 16px;
            background: var(--card);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            margin-bottom: 24px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header h1 {
            font-size: 2em;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        .header p {
            color: var(--text-2);
            font-size: 0.9em;
        }

        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .tab {
            flex: 1;
            min-width: 100px;
            padding: 12px 16px;
            background: var(--card);
            border: 2px solid transparent;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .tab.active {
            border-color: var(--primary);
            background: rgba(0, 212, 255, 0.1);
        }

        .tab h3 {
            font-size: 0.9em;
            margin-bottom: 4px;
        }

        .tab p {
            font-size: 0.75em;
            color: var(--text-2);
        }

        .form-section {
            background: var(--card);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .form-section h2 {
            font-size: 1.2em;
            margin-bottom: 16px;
            color: var(--primary);
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            color: var(--text-2);
            font-size: 0.85em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: var(--text-1);
            font-size: 1em;
        }

        .form-group input::placeholder {
            color: rgba(160, 160, 160, 0.5);
            font-size: 0.9em;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.3);
        }

        .form-group input:invalid {
            border-color: var(--danger);
        }

        .form-group input[required]:valid {
            border-color: var(--success);
        }

        .btn-calculate {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            margin: 24px 0;
        }

        .results {
            display: none;
        }

        .card {
            background: var(--card);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .card h2 {
            margin-bottom: 16px;
            text-align: center;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin-bottom: 16px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.03);
            padding: 16px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 8px 0;
        }

        .stat-label {
            color: var(--text-2);
            font-size: 0.8em;
        }

        .comparison {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 16px;
            margin: 24px 0;
        }

        .scenario {
            background: rgba(255, 255, 255, 0.03);
            padding: 16px;
            border-radius: 12px;
            border: 2px solid;
        }

        .scenario.existing {
            border-color: var(--warning);
        }

        .scenario.optimized {
            border-color: var(--success);
        }

        .vs-badge {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 50%;
            font-weight: bold;
            align-self: center;
        }

        canvas {
            max-width: 100%;
            height: auto !important;
        }

        @media (max-width: 768px) {
            .comparison {
                grid-template-columns: 1fr;
            }
            
            .vs-badge {
                margin: 8px auto;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .header h1 {
                font-size: 1.5em;
            }
        }

        .loading {
            text-align: center;
            padding: 40px;
            display: none;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body ontouchstart="">
    <div class="app-container">
        <div class="header">
            <h1>üöÄ NPS ORBIT</h1>
            <p>Your Intelligent Retirement Planner</p>
        </div>

        <div class="tabs">
            <div class="tab active" data-stage="young">
                <h3>üå± Early</h3>
                <p>20-30</p>
            </div>
            <div class="tab" data-stage="mid">
                <h3>‚õ∞Ô∏è Growth</h3>
                <p>31-45</p>
            </div>
            <div class="tab" data-stage="mature">
                <h3>üåÖ Peak</h3>
                <p>46-60</p>
            </div>
        </div>

        <div class="form-section">
            <h2>üìä Your Profile</h2>
            <div class="form-group">
                <label>Current Age <span style="color: var(--danger);">*</span></label>
                <input type="number" id="a1" value="30" min="18" max="65" required placeholder="Enter your current age">
            </div>
            <div class="form-group">
                <label>Retirement Age <span style="color: var(--danger);">*</span></label>
                <input type="number" id="a2" value="60" min="50" max="75" required placeholder="Planned retirement age">
            </div>
            <div class="form-group">
                <label>Annual Income (‚Çπ)</label>
                <input type="number" id="a3" value="600000" step="50000" min="0" placeholder="Optional: For reference only">
            </div>
        </div>

        <div class="form-section">
            <h2>üí∞ Contributions</h2>
            <div class="form-group">
                <label>NPS Tier</label>
                <select id="a4">
                    <option value="tier1">Tier I</option>
                    <option value="tier2">Tier II</option>
                    <option value="both">Both</option>
                </select>
            </div>
            <div class="form-group">
                <label>Monthly Contribution (‚Çπ) <span style="color: var(--danger);">*</span></label>
                <input type="number" id="a5" value="5000" step="500" min="0" required placeholder="Your monthly contribution">
            </div>
            <div class="form-group">
                <label>Employer Contribution (‚Çπ)</label>
                <input type="number" id="a6" value="5000" step="500" min="0" placeholder="Enter 0 if not applicable">
            </div>
        </div>

        <div class="form-section">
            <h2>üìà Strategy</h2>
            <div class="form-group">
                <label>Risk Profile</label>
                <select id="a7">
                    <option value="conservative">Conservative (8.5%)</option>
                    <option value="moderate" selected>Moderate (10%)</option>
                    <option value="aggressive">Aggressive (12%)</option>
                </select>
            </div>
            <div class="form-group">
                <label>Current NPS Balance (‚Çπ)</label>
                <input type="number" id="a8" value="0" step="10000" min="0" placeholder="Enter 0 if starting fresh">
            </div>
            <div class="form-group">
                <label>Salary Growth (%/year)</label>
                <input type="number" id="a9" value="7" step="0.5" min="0" max="20" placeholder="Expected annual raise">
            </div>
            <div class="form-group">
                <label>Inflation Rate (%/year)</label>
                <input type="number" id="a10" value="6" step="0.5" min="3" max="10" placeholder="Expected inflation">
            </div>
        </div>

        <button class="btn-calculate" onclick="_c()">üöÄ Calculate Your Future</button>

        <div class="loading">
            <div class="spinner"></div>
            <p>Analyzing 2,000 market scenarios...</p>
        </div>

        <div class="results">
            <div class="card">
                <h2>üìä Scenario Comparison</h2>
                <p style="text-align: center; color: var(--text-2); margin-bottom: 20px; font-size: 0.95em;">
                    Compare your current plan vs an optimized strategy with higher contributions
                </p>
                <div class="comparison">
                    <div class="scenario existing">
                        <h3 style="text-align: center; margin-bottom: 8px;">Current Path</h3>
                        <p style="text-align: center; color: var(--text-2); font-size: 0.85em; margin-bottom: 12px;">
                            Your current contribution strategy
                        </p>
                        <div id="r1"></div>
                    </div>
                    <div class="vs-badge">VS</div>
                    <div class="scenario optimized">
                        <h3 style="text-align: center; margin-bottom: 8px;">Optimized Path</h3>
                        <p style="text-align: center; color: var(--success); font-size: 0.85em; margin-bottom: 12px;">
                            ‚ú® 20% higher contributions + 10% annual increase
                        </p>
                        <div id="r2"></div>
                    </div>
                </div>
                <div id="r3" style="background: rgba(0, 255, 136, 0.1); padding: 16px; border-radius: 12px; text-align: center; margin-top: 16px;"></div>
                
                <div style="background: rgba(0, 212, 255, 0.1); padding: 16px; border-radius: 12px; margin-top: 16px; border-left: 4px solid var(--primary);">
                    <h3 style="font-size: 1em; margin-bottom: 12px; color: var(--primary);">üí° How to Achieve the Optimized Path:</h3>
                    <div id="actionSteps"></div>
                </div>
            </div>

            <div class="stats-grid" id="r4"></div>

            <div class="card">
                <h2>üéØ Probability Analysis</h2>
                <canvas id="r5"></canvas>
            </div>

            <div class="card">
                <h2>üíº Withdrawal Plan</h2>
                <div id="r6"></div>
            </div>

            <div class="card">
                <h2>üí° Smart Insights</h2>
                <div id="r7"></div>
            </div>
        </div>
    </div>

    <script>
        // Global error handler
        window.onerror = function(msg, url, line, col, error) {
            console.error('Error:', msg, 'at', line + ':' + col);
            return true; // Prevent default error handling
        };

        // Check if Chart.js loaded
        if (typeof Chart === 'undefined') {
            alert('‚ö†Ô∏è Chart library failed to load. Please check your internet connection and refresh the page.');
        }

        // Protection
        document.addEventListener('contextmenu', e => e.preventDefault());
        document.addEventListener('selectstart', e => e.preventDefault());
        document.addEventListener('copy', e => e.preventDefault());
        
        // Configuration
        const _p = {
            conservative: { r: 8.5, v: 8, e: 0.3, d: 0.65, a: 0.05 },
            moderate: { r: 10, v: 12, e: 0.5, d: 0.45, a: 0.05 },
            aggressive: { r: 12, v: 18, e: 0.75, d: 0.2, a: 0.05 }
        };

        // Core Engine
        function _s(p, n = 1000) {
            const r = [];
            for (let i = 0; i < n; i++) {
                let c = p.c0 || 0;
                let m = p.m;
                for (let y = 0; y < p.y; y++) {
                    const ag = p.a1 + y;
                    const rf = Math.max(0.3, (p.a2 - ag) / p.y);
                    const ar = p.ar * (0.7 + 0.3 * rf);
                    const av = p.v * rf;
                    for (let mo = 0; mo < 12; mo++) {
                        c += m;
                        const u1 = Math.random();
                        const u2 = Math.random();
                        const z = Math.sqrt(-2 * Math.log(u1)) * Math.cos(2 * Math.PI * u2);
                        const mr = (ar / 100 / 12) + z * (av / 100 / Math.sqrt(12));
                        c *= (1 + mr);
                    }
                    m *= (1 + p.si / 100);
                }
                r.push(Math.max(0, c));
            }
            return r.sort((a, b) => a - b);
        }

        function _f(amt) {
            if (amt >= 10000000) return '‚Çπ' + (amt / 10000000).toFixed(2) + ' Cr';
            if (amt >= 100000) return '‚Çπ' + (amt / 100000).toFixed(2) + ' L';
            return '‚Çπ' + amt.toLocaleString('en-IN');
        }

        function _c() {
            // Validate and set defaults
            try {
                const v1 = parseInt(document.getElementById('a1').value) || 30;
                const v2 = parseInt(document.getElementById('a2').value) || 60;
                const v3 = parseFloat(document.getElementById('a3').value) || 600000;
                const v4 = document.getElementById('a4').value || 'tier1';
                const v5 = parseFloat(document.getElementById('a5').value) || 0;
                const v6 = parseFloat(document.getElementById('a6').value) || 0;
                const v7 = document.getElementById('a7').value || 'moderate';
                const v8 = parseFloat(document.getElementById('a8').value) || 0;
                const v9 = parseFloat(document.getElementById('a9').value) || 7;
                const v10 = parseFloat(document.getElementById('a10').value) || 6;

                // Validation checks
                if (v1 < 18 || v1 > 65) {
                    alert('‚ö†Ô∏è Current age must be between 18 and 65 years');
                    document.querySelector('.loading').style.display = 'none';
                    return;
                }
                if (v2 < 50 || v2 > 75) {
                    alert('‚ö†Ô∏è Retirement age must be between 50 and 75 years');
                    document.querySelector('.loading').style.display = 'none';
                    return;
                }
                if (v2 <= v1) {
                    alert('‚ö†Ô∏è Retirement age must be greater than current age');
                    document.querySelector('.loading').style.display = 'none';
                    return;
                }
                if (v5 + v6 <= 0) {
                    alert('‚ö†Ô∏è Total monthly contribution must be greater than zero.\nPlease enter at least one contribution amount.');
                    document.querySelector('.loading').style.display = 'none';
                    return;
                }
                if (v3 < 0 || v9 < 0 || v10 < 0) {
                    alert('‚ö†Ô∏è Income, salary growth, and inflation cannot be negative');
                    document.querySelector('.loading').style.display = 'none';
                    return;
                }

                document.querySelector('.loading').style.display = 'block';
                document.querySelector('.results').style.display = 'none';
                
                setTimeout(() => {
                    _run(v1, v2, v3, v4, v5, v6, v7, v8, v9, v10);
                }, 100);
            } catch (err) {
                alert('‚ö†Ô∏è Please check your inputs and try again.\n\nError: Invalid input values');
                document.querySelector('.loading').style.display = 'none';
                console.error('Calculation error:', err);
            }
        }

        function _run(v1, v2, v3, v4, v5, v6, v7, v8, v9, v10) {
            try {

                const y = v2 - v1;
                const mt = v5 + v6;
                const cfg = _p[v7];

                if (!cfg) {
                    throw new Error('Invalid risk profile');
                }

                // Scenario 1: Current
                const p1 = {
                    y: y,
                    m: mt,
                    ar: cfg.r,
                    v: cfg.v,
                    si: v9,
                    c0: v8,
                    a1: v1,
                    a2: v2
                };
                const s1 = _s(p1);

                // Scenario 2: Optimized
                const p2 = {
                    y: y,
                    m: mt * 1.2,
                    ar: cfg.r,
                    v: cfg.v,
                    si: Math.max(v9, 10),
                    c0: v8,
                    a1: v1,
                    a2: v2
                };
                const s2 = _s(p2);

                const e10 = s1[Math.floor(s1.length * 0.1)];
                const e50 = s1[Math.floor(s1.length * 0.5)];
                const e90 = s1[Math.floor(s1.length * 0.9)];
                const o10 = s2[Math.floor(s2.length * 0.1)];
                const o50 = s2[Math.floor(s2.length * 0.5)];
                const o90 = s2[Math.floor(s2.length * 0.9)];

                // Calculate contributions
                let tc1 = v8, tc2 = v8;
                let m1 = mt, m2 = mt * 1.2;
                for (let i = 0; i < y; i++) {
                    tc1 += m1 * 12;
                    tc2 += m2 * 12;
                    m1 *= (1 + v9 / 100);
                    m2 *= (1 + Math.max(v9, 10) / 100);
                }

                const ep = (e50 * 0.4 * 0.06) / 12;
                const op = (o50 * 0.4 * 0.06) / 12;

                // Calculate action steps BEFORE displaying results
                const currentMonthly = mt;
                const optimizedMonthly = mt * 1.2;
                const monthlyIncrease = optimizedMonthly - currentMonthly;
                const annualIncrease = monthlyIncrease * 12;
                const currentAnnual = currentMonthly * 12;
                const optimizedAnnual = optimizedMonthly * 12;

                // Display results
                document.getElementById('r1').innerHTML = `
                    <div style="margin: 8px 0; padding: 8px; background: rgba(255,255,255,0.03); border-radius: 8px;">
                        <div style="font-size: 0.8em; color: var(--text-2);">Corpus</div>
                        <div style="font-size: 1.2em; font-weight: bold;">${_f(e50)}</div>
                    </div>
                    <div style="margin: 8px 0; padding: 8px; background: rgba(255,255,255,0.03); border-radius: 8px;">
                        <div style="font-size: 0.8em; color: var(--text-2);">Pension</div>
                        <div style="font-size: 1.2em; font-weight: bold;">${_f(ep)}</div>
                    </div>
                `;

                document.getElementById('r2').innerHTML = `
                    <div style="margin: 8px 0; padding: 8px; background: rgba(255,255,255,0.03); border-radius: 8px;">
                        <div style="font-size: 0.8em; color: var(--text-2);">Corpus</div>
                        <div style="font-size: 1.2em; font-weight: bold; color: var(--success);">${_f(o50)}</div>
                        <div style="font-size: 0.75em; color: var(--success); margin-top: 4px;">‚Üë ${_f(o50 - e50)} more than current</div>
                    </div>
                    <div style="margin: 8px 0; padding: 8px; background: rgba(255,255,255,0.03); border-radius: 8px;">
                        <div style="font-size: 0.8em; color: var(--text-2);">Pension</div>
                        <div style="font-size: 1.2em; font-weight: bold; color: var(--success);">${_f(op)}</div>
                        <div style="font-size: 0.75em; color: var(--success); margin-top: 4px;">‚Üë ${_f(op - ep)} more than current</div>
                    </div>
                    <div style="margin: 8px 0; padding: 10px; background: rgba(0,255,136,0.1); border-radius: 8px; border: 1px solid var(--success);">
                        <div style="font-size: 0.75em; color: var(--text-2); margin-bottom: 4px;">To achieve this:</div>
                        <div style="font-size: 0.85em; color: var(--success);">
                            <strong>‚Ä¢ Increase monthly: +${_f(monthlyIncrease)}</strong><br>
                            <strong>‚Ä¢ Annual auto-increase: 10%</strong>
                        </div>
                    </div>
                `;

                const diff = o50 - e50;
                const pct = ((diff / e50) * 100).toFixed(1);
                document.getElementById('r3').innerHTML = `
                    <div style="font-size: 1.3em; font-weight: bold; color: var(--success); margin-bottom: 8px;">
                        +${_f(diff)} (${pct}% gain)
                    </div>
                    <div style="font-size: 0.9em; color: var(--text-2);">
                        By optimizing your strategy, you gain an extra ${_f(diff)} at retirement
                    </div>
                `;

                // Calculate what percentage of income this represents
                const incomePercent = v3 > 0 ? ((optimizedMonthly / (v3 / 12)) * 100).toFixed(1) : 0;

                // Generate actionable steps
                let actionHTML = '<div style="font-size: 0.9em; line-height: 1.8;">';
                
                actionHTML += `<div style="margin: 8px 0; padding: 8px; background: rgba(255,255,255,0.03); border-radius: 6px;">`;
                actionHTML += `<strong>Step 1:</strong> Increase your monthly contribution by <strong style="color: var(--success);">${_f(monthlyIncrease)}</strong>`;
                actionHTML += `<br><span style="color: var(--text-2); font-size: 0.9em;">From ${_f(currentMonthly)}/month ‚Üí ${_f(optimizedMonthly)}/month</span>`;
                actionHTML += `</div>`;

                actionHTML += `<div style="margin: 8px 0; padding: 8px; background: rgba(255,255,255,0.03); border-radius: 6px;">`;
                actionHTML += `<strong>Step 2:</strong> Set up an annual auto-increase of <strong style="color: var(--success);">10%</strong>`;
                actionHTML += `<br><span style="color: var(--text-2); font-size: 0.9em;">This helps your contributions keep pace with salary increments</span>`;
                actionHTML += `</div>`;

                if (v3 > 0) {
                    actionHTML += `<div style="margin: 8px 0; padding: 8px; background: rgba(255,255,255,0.03); border-radius: 6px;">`;
                    actionHTML += `<strong>Step 3:</strong> Target ${incomePercent}% of your monthly income for retirement`;
                    actionHTML += `<br><span style="color: var(--text-2); font-size: 0.9em;">Financial experts recommend 15-20% for secure retirement</span>`;
                    actionHTML += `</div>`;
                }

                actionHTML += `<div style="margin: 8px 0; padding: 8px; background: rgba(255,255,255,0.03); border-radius: 6px;">`;
                actionHTML += `<strong>Quick Win:</strong> Allocate your next bonus or increment to NPS`;
                actionHTML += `<br><span style="color: var(--text-2); font-size: 0.9em;">Example: ‚Çπ50,000 bonus = ‚Çπ4,166/month extra for a year</span>`;
                actionHTML += `</div>`;

                // Show tax savings from increased contribution
                const currentTaxSaving = Math.min(currentAnnual, 200000) * 0.3;
                const optimizedTaxSaving = Math.min(optimizedAnnual, 200000) * 0.3;
                const extraTaxSaving = optimizedTaxSaving - currentTaxSaving;

                if (extraTaxSaving > 0) {
                    actionHTML += `<div style="margin: 8px 0; padding: 8px; background: rgba(0,255,136,0.1); border-radius: 6px; border: 1px solid var(--success);">`;
                    actionHTML += `<strong>üí∞ Bonus:</strong> You'll save an extra <strong style="color: var(--success);">${_f(extraTaxSaving)}</strong> in taxes annually!`;
                    actionHTML += `<br><span style="color: var(--text-2); font-size: 0.9em;">Under Section 80CCD(1B), additional deduction available</span>`;
                    actionHTML += `</div>`;
                }

                actionHTML += '</div>';
                document.getElementById('actionSteps').innerHTML = actionHTML;

                document.getElementById('r4').innerHTML = `
                    <div class="stat-card">
                        <div class="stat-label">Expected</div>
                        <div class="stat-value">${_f(o50)}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Conservative</div>
                        <div class="stat-value">${_f(o10)}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Optimistic</div>
                        <div class="stat-value">${_f(o90)}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Monthly Pension</div>
                        <div class="stat-value">${_f(op)}</div>
                    </div>
                `;

                document.getElementById('r6').innerHTML = `
                    <div style="margin: 12px 0; padding: 12px; background: rgba(255,255,255,0.03); border-radius: 8px; display: flex; justify-content: space-between;">
                        <span>60% Lump Sum (Tax-Free)</span>
                        <strong>${_f(o50 * 0.6)}</strong>
                    </div>
                    <div style="margin: 12px 0; padding: 12px; background: rgba(255,255,255,0.03); border-radius: 8px; display: flex; justify-content: space-between;">
                        <span>40% Annuity</span>
                        <strong>${_f(o50 * 0.4)}</strong>
                    </div>
                    <div style="margin: 12px 0; padding: 12px; background: rgba(255,255,255,0.03); border-radius: 8px; display: flex; justify-content: space-between;">
                        <span>Monthly Pension (6% rate)</span>
                        <strong>${_f(op)}</strong>
                    </div>
                `;

                document.getElementById('r7').innerHTML = `
                    <div style="margin: 12px 0; padding: 12px; background: rgba(0,212,255,0.05); border-left: 3px solid var(--primary); border-radius: 8px;">
                        <strong>üí° Growth Power:</strong> Your optimization strategy boosts retirement corpus by ${_f(diff)} (${pct}% increase). This is achieved through:
                        <ul style="margin: 8px 0 0 20px; color: var(--text-2); font-size: 0.9em;">
                            <li>20% higher monthly contributions (${_f(monthlyIncrease)} extra/month)</li>
                            <li>10% annual auto-increase (compounds over ${y} years)</li>
                            <li>Power of compound interest on larger base</li>
                        </ul>
                    </div>
                    <div style="margin: 12px 0; padding: 12px; background: rgba(0,212,255,0.05); border-left: 3px solid var(--primary); border-radius: 8px;">
                        <strong>üéØ Pension Impact:</strong> Your monthly pension increases by ${_f(op - ep)} with the optimized plan.
                        <ul style="margin: 8px 0 0 20px; color: var(--text-2); font-size: 0.9em;">
                            <li>Current plan pension: ${_f(ep)}/month</li>
                            <li>Optimized plan pension: ${_f(op)}/month</li>
                            <li>That's ${_f((op - ep) * 12)}/year more in retirement!</li>
                        </ul>
                    </div>
                    <div style="margin: 12px 0; padding: 12px; background: rgba(0,212,255,0.05); border-left: 3px solid var(--primary); border-radius: 8px;">
                        <strong>üìä Risk Profile:</strong> Your ${v7} strategy has a variance of ¬±${((o90 - o10) / o50 * 100).toFixed(0)}%. Range: ${_f(o10)} to ${_f(o90)}.
                        <ul style="margin: 8px 0 0 20px; color: var(--text-2); font-size: 0.9em;">
                            <li>10% probability of ${_f(o10)} or less (worst case)</li>
                            <li>50% probability of ${_f(o50)} (most likely)</li>
                            <li>10% probability of ${_f(o90)} or more (best case)</li>
                        </ul>
                    </div>
                    <div style="margin: 12px 0; padding: 12px; background: rgba(255,215,0,0.1); border-left: 3px solid var(--accent); border-radius: 8px;">
                        <strong>‚ö° Action Tip:</strong> Start small! Even increasing by ‚Çπ1,000/month today can add ${_f((o50 - e50) / (monthlyIncrease / 1000) * 1000)} to your retirement corpus. Every rupee counts with ${y} years of compounding.
                    </div>
                `;

                // Chart
                const bins = 15;
                const all = [...s1, ...s2];
                const min = Math.min(...all);
                const max = Math.max(...all);
                const bs = (max - min) / bins;
                
                const h1 = new Array(bins).fill(0);
                const h2 = new Array(bins).fill(0);
                
                s1.forEach(r => {
                    const b = Math.min(Math.floor((r - min) / bs), bins - 1);
                    h1[b]++;
                });
                
                s2.forEach(r => {
                    const b = Math.min(Math.floor((r - min) / bs), bins - 1);
                    h2[b]++;
                });

                const labels = [];
                for (let i = 0; i < bins; i++) {
                    const v = min + (i + 0.5) * bs;
                    labels.push(v >= 10000000 ? (v / 10000000).toFixed(1) + 'Cr' : (v / 100000).toFixed(0) + 'L');
                }

                const ctx = document.getElementById('r5');
                if (!ctx) {
                    throw new Error('Chart canvas not found');
                }
                
                // Destroy previous chart if exists
                if (window._chartInstance) {
                    window._chartInstance.destroy();
                }

                window._chartInstance = new Chart(ctx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Current',
                                data: h1,
                                backgroundColor: 'rgba(255, 170, 0, 0.5)',
                                borderColor: 'rgba(255, 170, 0, 1)',
                                borderWidth: 1
                            },
                            {
                                label: 'Optimized',
                                data: h2,
                                backgroundColor: 'rgba(0, 255, 136, 0.5)',
                                borderColor: 'rgba(0, 255, 136, 1)',
                                borderWidth: 1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                ticks: { color: '#ffffff' }
                            },
                            x: {
                                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                ticks: { color: '#ffffff', maxRotation: 45, minRotation: 45 }
                            }
                        },
                        plugins: {
                            legend: { labels: { color: '#ffffff' } },
                            title: {
                                display: true,
                                text: '1,000 Probability Simulations per Strategy',
                                color: '#ffffff',
                                font: { size: 14 }
                            }
                        }
                    }
                });

                document.querySelector('.loading').style.display = 'none';
                document.querySelector('.results').style.display = 'block';
                document.querySelector('.results').scrollIntoView({ behavior: 'smooth' });
            } catch (err) {
                document.querySelector('.loading').style.display = 'none';
                alert('‚ö†Ô∏è Calculation error. Please check your inputs and try again.\n\n' + err.message);
                console.error('Runtime error:', err);
            }
        }

        // Tabs
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
            });
        });

        // Console protection
        (function() {
            const noop = () => {};
            ['log', 'warn', 'error', 'debug', 'info'].forEach(m => console[m] = noop);
        })();
    </script>
</body>
</html>
